<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="HTML5," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="曾几何时为了兼容IE低版本浏览器而头痛，以为到Mobile时代可以跟这些麻烦说拜拜。可没想到到了移动时代，为了处理各终端的适配而乱了手脚。对于混迹各社区的偶，时常发现大家拿手机淘宝的H5页面做讨论——手淘的H5页面是如何实现多终端的适配？那么趁此Amfe阿里无线前端团队双11技术连载之际，用一个实战案例来告诉大家，手淘的H5页面是如何实现多终端适配的，希望这篇文章对大家在Mobile的世界中能过得">
<meta property="og:type" content="article">
<meta property="og:title" content="使用Flexible实现手淘H5页面的终端适配 🍧">
<meta property="og:url" content="https://menggeniu.github.io/2016/06/10/38/index.html">
<meta property="og:site_name" content="NNNの博客">
<meta property="og:description" content="曾几何时为了兼容IE低版本浏览器而头痛，以为到Mobile时代可以跟这些麻烦说拜拜。可没想到到了移动时代，为了处理各终端的适配而乱了手脚。对于混迹各社区的偶，时常发现大家拿手机淘宝的H5页面做讨论——手淘的H5页面是如何实现多终端的适配？那么趁此Amfe阿里无线前端团队双11技术连载之际，用一个实战案例来告诉大家，手淘的H5页面是如何实现多终端适配的，希望这篇文章对大家在Mobile的世界中能过得">
<meta property="og:image" content="http://cdn1.w3cplus.com/cdn/farfuture/HNLqSu8yuVeiaSsWQan4hEQMizO0S6Pii5NqPp2rBBY/mtime:1447769998/sites/default/files/blogs/2015/1511/rem-1.jpg">
<meta property="og:image" content="http://cdn2.w3cplus.com/cdn/farfuture/RqdfEdIqyYInpUeFzDLoWrYJIaGIHzqPMrRWT9merUc/mtime:1448593751/sites/default/files/blogs/2015/1511/yiboqr.png">
<meta property="og:image" content="http://cdn1.w3cplus.com/cdn/farfuture/dAIFVQ4Hwx0DpAzSegmu2m3rYce0Z_u5XbZ2H49L94A/mtime:1447771098/sites/default/files/blogs/2015/1511/rem-4.png">
<meta property="og:image" content="http://cdn2.w3cplus.com/cdn/farfuture/M-e4_frBiR-exi9UaMTGMIa5NCWj6Bh1LJeAmb_yhtE/mtime:1447815283/sites/default/files/blogs/2015/1511/rem-7.png">
<meta property="og:image" content="http://cdn.w3cplus.com/cdn/farfuture/ue4cH6tebXis4kq8W6ZU4afq5M4Tcl_dQbgiuTeSA7g/mtime:1447899085/sites/default/files/blogs/2015/1511/rem-11.png">
<meta property="og:image" content="http://cdn1.w3cplus.com/cdn/farfuture/Ir5AUumC72bH2nCmHgjR1OEPjAukzoPUgobXkpkiP6k/mtime:1447771790/sites/default/files/blogs/2015/1511/rem-6.jpg">
<meta property="og:image" content="http://cdn.w3cplus.com/cdn/farfuture/Ie9-HRL4sYocKldzQvdwaoMVpbaS29xW13xcQMi9Q3k/mtime:1447770328/sites/default/files/blogs/2015/1511/rem-3.jpg">
<meta property="og:image" content="http://cdn.w3cplus.com/cdn/farfuture/hDnI5i1yyMPEDwG95I1vaigCKBysWlqydUCR6kgbKL4/mtime:1355415450/sites/default/files/blogs/201212/retina-web-1.jpg">
<meta property="og:image" content="http://cdn.w3cplus.com/cdn/farfuture/nvkUxqPg1a8coYtT29P7ghiy85RsGNz4aI5FVm4TVFg/mtime:1355415452/sites/default/files/blogs/201212/retina-web-3.jpg">
<meta property="og:image" content="http://cdn2.w3cplus.com/cdn/farfuture/8d__kFmdRwAU9j8EdBwuaGE9dWFoVIhEMRMFV1oV-4U/mtime:1355415458/sites/default/files/blogs/201212/retina-web-10.jpg">
<meta property="og:image" content="http://cdn2.w3cplus.com/cdn/farfuture/hKfao4CS_yygi0EEUF1xMOb7NROYEu680tlykfjZzLs/mtime:1447828705/sites/default/files/blogs/2015/1511/rem-8.png">
<meta property="og:image" content="http://cdn1.w3cplus.com/cdn/farfuture/h0w7oXfqJgirNWw4PPa2GZWyyAsPRGvxLRWCZYPE_Y4/mtime:1447769998/sites/default/files/blogs/2015/1511/rem-2.jpg">
<meta property="og:image" content="http://cdn1.w3cplus.com/cdn/farfuture/Mn934L-OJUnahLoJ7qLdEDvmYFbD_O8SVgH7SovnaWg/mtime:1447830963/sites/default/files/blogs/2015/1511/cssrem.gif">
<meta property="og:image" content="http://cdn.w3cplus.com/cdn/farfuture/YhlgyAvcvtOe54709eeCV9lrooOFzNJIhMEEj921fzs/mtime:1447841119/sites/default/files/blogs/2015/1511/rem-9.jpg">
<meta property="og:image" content="http://cdn2.w3cplus.com/cdn/farfuture/gL7chP84773JBDGVVNjVp2m7yl2s9ecFv54nyQcaikk/mtime:1447841119/sites/default/files/blogs/2015/1511/rem-10.png">
<meta property="og:image" content="http://cdn2.w3cplus.com/cdn/farfuture/RqdfEdIqyYInpUeFzDLoWrYJIaGIHzqPMrRWT9merUc/mtime:1448593751/sites/default/files/blogs/2015/1511/yiboqr.png">
<meta property="og:updated_time" content="2016-11-19T12:03:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用Flexible实现手淘H5页面的终端适配 🍧">
<meta name="twitter:description" content="曾几何时为了兼容IE低版本浏览器而头痛，以为到Mobile时代可以跟这些麻烦说拜拜。可没想到到了移动时代，为了处理各终端的适配而乱了手脚。对于混迹各社区的偶，时常发现大家拿手机淘宝的H5页面做讨论——手淘的H5页面是如何实现多终端的适配？那么趁此Amfe阿里无线前端团队双11技术连载之际，用一个实战案例来告诉大家，手淘的H5页面是如何实现多终端适配的，希望这篇文章对大家在Mobile的世界中能过得">
<meta name="twitter:image" content="http://cdn1.w3cplus.com/cdn/farfuture/HNLqSu8yuVeiaSsWQan4hEQMizO0S6Pii5NqPp2rBBY/mtime:1447769998/sites/default/files/blogs/2015/1511/rem-1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://menggeniu.github.io/2016/06/10/38/"/>





  <title> 使用Flexible实现手淘H5页面的终端适配 🍧 | NNNの博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">NNNの博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">世上所有的相遇都是久别重逢</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://menggeniu.github.io/2016/06/10/38/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="menggeNIU">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="NNNの博客">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="NNNの博客" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                使用Flexible实现手淘H5页面的终端适配 🍧
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-06-10T21:26:33+08:00">
                2016-06-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/06/10/38/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/10/38/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/06/10/38/" class="leancloud_visitors" data-flag-title="使用Flexible实现手淘H5页面的终端适配 🍧">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>曾几何时为了兼容IE低版本浏览器而头痛，以为到Mobile时代可以跟这些麻烦说拜拜。可没想到到了移动时代，为了处理各终端的适配而乱了手脚。对于混迹各社区的偶，时常发现大家拿<strong>手机淘宝的H5页面做讨论——手淘的H5页面是如何实现多终端的适配</strong>？<br><br>那么趁此<strong>Amfe阿里无线前端团队双11技术连载</strong>之际，用一个实战案例来告诉大家，手淘的H5页面是如何实现多终端适配的，希望这篇文章对大家在Mobile的世界中能过得更轻松。<br></p>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><hr>
<p>拿一个双11的Mobile页面来做案例，比如你实现一个类似下图的一个H5页面：<br><br><img src="http://cdn1.w3cplus.com/cdn/farfuture/HNLqSu8yuVeiaSsWQan4hEQMizO0S6Pii5NqPp2rBBY/mtime:1447769998/sites/default/files/blogs/2015/1511/rem-1.jpg" alt=""><br><br>目标很清晰，就是做一个这样的H5页面。<br><br><a href="http://huodong.m.taobao.com/act/yibo.html" target="_blank" rel="external">DEMO</a><br><br>请用手机扫下面的二维码<br><br><img src="http://cdn2.w3cplus.com/cdn/farfuture/RqdfEdIqyYInpUeFzDLoWrYJIaGIHzqPMrRWT9merUc/mtime:1448593751/sites/default/files/blogs/2015/1511/yiboqr.png" alt=""><br></p>
<h3 id="痛点"><a href="#痛点" class="headerlink" title="痛点"></a>痛点</h3><hr>
<p>虽然H5的页面与PC的Web页面相比简单了不少，但让我们头痛的事情是要想尽办法让页面能适配众多不同的终端设备。看看下图你就会知道，这是多么痛苦的一件事情：<br><br><img src="http://cdn1.w3cplus.com/cdn/farfuture/dAIFVQ4Hwx0DpAzSegmu2m3rYce0Z_u5XbZ2H49L94A/mtime:1447771098/sites/default/files/blogs/2015/1511/rem-4.png" alt=""><br><br>点击<a href="https://design.google.com/devices/" target="_blank" rel="external">这里</a>查看更多终端设备的参数。<br><br>再来看看手淘H5要适配的终端设备数据：<br><br><img src="http://cdn2.w3cplus.com/cdn/farfuture/M-e4_frBiR-exi9UaMTGMIa5NCWj6Bh1LJeAmb_yhtE/mtime:1447815283/sites/default/files/blogs/2015/1511/rem-7.png" alt=""><br><br>看到这些数据，是否死的心都有了，或者说为此捏了一把汗出来。<br></p>
<h3 id="手淘团队适配协作模式"><a href="#手淘团队适配协作模式" class="headerlink" title="手淘团队适配协作模式"></a>手淘团队适配协作模式</h3><hr>
<p>早期移动端开发，对于终端设备适配问题只属于Android系列，只不过很多设计师常常忽略Android适配问题，只出一套iOS平台设计稿。但随着iPhone6，iPhone6+的出现，从此终端适配问题不再是Android系列了，也从这个时候让移动端适配全面进入到“杂屏”时代。<br><br><img src="http://cdn.w3cplus.com/cdn/farfuture/ue4cH6tebXis4kq8W6ZU4afq5M4Tcl_dQbgiuTeSA7g/mtime:1447899085/sites/default/files/blogs/2015/1511/rem-11.png" alt=""><br><br>上图来自于<a href="https://www.paintcodeapp.com/news/ultimate-guide-to-iphone-resolutions" target="_blank" rel="external">paintcodeapp.com</a><br><br>为了应对这多么的终端设备，设计师和前端开发之间又应该采用什么协作模式？或许大家对此也非常感兴趣。<br><br>而整个手淘设计师和前端开发的适配协作基本思路是：<br></p>
<ul>
<li>选择一种尺寸作为设计和开发基准</li>
<li>定义一套适配规则，自动适配剩下的两种尺寸(其实不仅这两种，你懂的)</li>
<li>特殊适配效果给出设计效果</li>
</ul>
<p>还是上一张图吧，因为一图胜过千言万语：<br><br><img src="http://cdn1.w3cplus.com/cdn/farfuture/Ir5AUumC72bH2nCmHgjR1OEPjAukzoPUgobXkpkiP6k/mtime:1447771790/sites/default/files/blogs/2015/1511/rem-6.jpg" alt=""><br><br>在此也不做更多的阐述。在手淘的设计师和前端开发协作过程中：<strong>手淘设计师常选择iPhone6作为基准设计尺寸，交付给前端的设计尺寸是按<code>750px * 1334px</code>为准(高度会随着内容多少而改变)。前端开发人员通过一套适配规则自动适配到其他的尺寸</strong>。<br><br>根据上面所说的，设计师给我们的设计图是一个<code>750px * 1600px</code>的页面：<br><br><img src="http://cdn.w3cplus.com/cdn/farfuture/Ie9-HRL4sYocKldzQvdwaoMVpbaS29xW13xcQMi9Q3k/mtime:1447770328/sites/default/files/blogs/2015/1511/rem-3.jpg" alt=""><br></p>
<h3 id="前端开发完成终端适配方案"><a href="#前端开发完成终端适配方案" class="headerlink" title="前端开发完成终端适配方案"></a>前端开发完成终端适配方案</h3><hr>
<p>拿到设计师给的设计图之后，剩下的事情是前端开发人员的事了。而手淘经过多年的摸索和实战，总结了一套移动端适配的方案——<a href="https://github.com/amfe/lib-flexible" target="_blank" rel="external">flexible方案</a>。<br><br>这种方案具体在实际开发中如何使用，暂时先卖个关子，在继续详细的开发实施之前，我们要先了解一些基本概念。<br></p>
<h4 id="一些基本概念"><a href="#一些基本概念" class="headerlink" title="一些基本概念"></a>一些基本概念</h4><p>在进行具体实战之前，首先得了解下面这些基本概念(术语)：<br></p>
<h5 id="视窗-viewport"><a href="#视窗-viewport" class="headerlink" title="视窗 viewport"></a>视窗 viewport</h5><p>简单的理解，viewport是严格等于浏览器的窗口。在桌面浏览器中，viewport就是浏览器窗口的宽度高度。但在移动端设备上就有点复杂。<br><br>移动端的viewport太窄，为了能更好为CSS布局服务，所以提供了两个viewport:虚拟的viewportvisualviewport和布局的viewportlayoutviewport。<br><br>eorge Cummins在Stack Overflow上<a href="http://stackoverflow.com/questions/6333927/difference-between-visual-viewport-and-layout-viewport" target="_blank" rel="external">对这两个基本概念做了详细的解释</a>。<br><br>而事实上viewport是一个很复杂的知识点，上面的简单描述可能无法帮助你更好的理解viewport，而你又想对此做更深的了解，可以阅读<a href="http://www.w3cplus.com/css/viewports.html" target="_blank" rel="external">PPK写的相关教程</a>。<br></p>
<h5 id="物理像素-physical-pixel"><a href="#物理像素-physical-pixel" class="headerlink" title="物理像素(physical pixel)"></a>物理像素(physical pixel)</h5><p>理像素又被称为设备像素，他是显示设备中一个最微小的物理部件。每个像素可以根据操作系统设置自己的颜色和亮度。正是这些设备像素的微小距离欺骗了我们肉眼看到的图像效果。<br><br><img src="http://cdn.w3cplus.com/cdn/farfuture/hDnI5i1yyMPEDwG95I1vaigCKBysWlqydUCR6kgbKL4/mtime:1355415450/sites/default/files/blogs/201212/retina-web-1.jpg" alt=""><br></p>
<h5 id="设备独立像素-density-independent-pixel"><a href="#设备独立像素-density-independent-pixel" class="headerlink" title="设备独立像素(density-independent pixel)"></a>设备独立像素(density-independent pixel)</h5><p>设备独立像素也称为密度无关像素，可以认为是计算机坐标系统中的一个点，这个点代表一个可以由程序使用的虚拟像素(比如说CSS像素)，然后由相关系统转换为物理像素。<br></p>
<h5 id="CSS像素"><a href="#CSS像素" class="headerlink" title="CSS像素"></a>CSS像素</h5><p>CSS像素是一个抽像的单位，主要使用在浏览器上，用来精确度量Web页面上的内容。一般情况之下，CSS像素称为与设备无关的像素(device-independent pixel)，简称DIPs。<br></p>
<h5 id="屏幕密度"><a href="#屏幕密度" class="headerlink" title="屏幕密度"></a>屏幕密度</h5><p>屏幕密度是指一个设备表面上存在的像素数量，它通常以每英寸有多少像素来计算(PPI)。<br></p>
<h5 id="设备像素比-device-pixel-ratio"><a href="#设备像素比-device-pixel-ratio" class="headerlink" title="设备像素比(device pixel ratio)"></a>设备像素比(device pixel ratio)</h5><p>设备像素比简称为dpr，其定义了物理像素和设备独立像素的对应关系。它的值可以按下面的公式计算得到：<br></p>
<pre><code>设备像素比 ＝ 物理像素 / 设备独立像素
</code></pre><p>在JavaScript中，可以通过<code>window.devicePixelRatio</code>获取到当前设备的dpr。而在CSS中，可以通过<code>-webkit-device-pixel-ratio</code>，<code>-webkit-min-device-pixel-ratio</code>和 <code>-webkit-max-device-pixel-ratio</code>进行媒体查询，对不同dpr的设备，做一些样式适配(这里只针对webkit内核的浏览器和webview)。<br><br>dip或dp,（device independent pixels，设备独立像素）与屏幕密度有关。dip可以用来辅助区分视网膜设备还是非视网膜设备。<br><br>缩合上述的几个概念，用一张图来解释：<br><br><img src="http://cdn.w3cplus.com/cdn/farfuture/nvkUxqPg1a8coYtT29P7ghiy85RsGNz4aI5FVm4TVFg/mtime:1355415452/sites/default/files/blogs/201212/retina-web-3.jpg" alt=""><br><br>众所周知，iPhone6的设备宽度和高度为<code>375pt * 667pt</code>,可以理解为设备的独立像素；而其dpr为2，根据上面公式，我们可以很轻松得知其物理像素为<code>750pt * 1334pt</code>。<br><br>如下图所示，某元素的CSS样式：<br></p>
<pre><code>width: 2px;
height: 2px；
</code></pre><p>在不同的屏幕上，CSS像素所呈现的物理尺寸是一致的，而不同的是CSS像素所对应的物理像素具数是不一致的。在普通屏幕下<code>1</code>个CSS像素对应<code>1</code>个物理像素，而在Retina屏幕下，<code>1</code>个CSS像素对应的却是<code>4</code>个物理像素。<br><br>有关于更多的介绍可以<a href="http://www.w3cplus.com/css/towards-retina-web.html" target="_blank" rel="external">点击这里</a>详细了解。<br><br>看到这里，你能感觉到，在移动端时代屏幕适配除了Layout之外，还要考虑到图片的适配，因为其直接影响到页面显示质量，对于如何实现图片适配，再此不做过多详细阐述。这里盗用了<a href="http://www.nangongruiyang.com/" target="_blank" rel="external">@南宮瑞揚</a>根据<a href="http://mir.aculo.us/2012/06/26/flowchart-how-to-retinafy-your-website/" target="_blank" rel="external">mir.aculo.us</a>翻译的一张信息图：<br><br><img src="http://cdn2.w3cplus.com/cdn/farfuture/8d__kFmdRwAU9j8EdBwuaGE9dWFoVIhEMRMFV1oV-4U/mtime:1355415458/sites/default/files/blogs/201212/retina-web-10.jpg" alt=""><br></p>
<h4 id="meta标签"><a href="#meta标签" class="headerlink" title="meta标签"></a>meta标签</h4><p><code>&lt;meta&gt;</code>标签有很多种，而这里要着重说的是viewport的<code>meta</code>标签，其主要用来告诉浏览器如何规范的渲染Web页面，而你则需要告诉它视窗有多大。在开发移动端页面，我们需要设置<code>meta</code>标签如下：<br></p>
<pre><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;&gt;
</code></pre><p>代码以显示网页的屏幕宽度定义了视窗宽度。网页的比例和最大比例被设置为100%。<br><br>留个悬念，因为后面的解决方案中需要重度依赖<code>meta</code>标签。<br></p>
<h4 id="CSS单位rem"><a href="#CSS单位rem" class="headerlink" title="CSS单位rem"></a>CSS单位rem</h4><p>在<a href="https://www.w3.org/TR/css3-values/#rem-unit" target="_blank" rel="external">W3C</a>规范中是这样描述rem的:<br></p>
<pre><code>font size of the root element.
</code></pre><p>简单的理解，<code>rem</code>就是相对于根元素<code>&lt;html&gt;</code>的<code>font-size</code>来做计算。而我们的方案中使用<code>rem</code>单位，是能轻易的根据<code>&lt;html&gt;</code>的<code>font-size</code>计算出元素的盒模型大小。而这个特色对我们来说是特别的有益处。<br></p>
<h3 id="前端实现方案"><a href="#前端实现方案" class="headerlink" title="前端实现方案"></a>前端实现方案</h3><p>解了前面一些相关概念之后，接下来我们来看实际解决方案。在整个手淘团队，我们有一个名叫lib-flexible的库，而这个库就是用来解决H5页面终端适配的。<br></p>
<h4 id="lib-flexible是什么？"><a href="#lib-flexible是什么？" class="headerlink" title="lib-flexible是什么？"></a>lib-flexible是什么？</h4><p><a href="https://github.com/amfe/lib-flexible" target="_blank" rel="external">lib-flexible</a>是一个制作H5适配的开源库，可以点击<a href="https://github.com/amfe/lib-flexible/archive/master.zip" target="_blank" rel="external">这里下载</a>相关文件，获取需要的JavaScript和CSS文件。<br><br>当然你可以直接使用阿里CDN：<br></p>
<pre><code>&lt;script src=&quot;http://g.tbcdn.cn/mtb/lib-flexible/{{version}}/??flexible_css.js,flexible.js&quot;&gt;&lt;/script&gt;
</code></pre><p>代码中的<code></code>换成对应的版本号<code>0.3.4</code>。<br></p>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><p><a href="https://github.com/amfe/lib-flexible" target="_blank" rel="external">lib-flexible</a>库的使用方法非常的简单，只需要在Web页面的<code>&lt;head&gt;&lt;/head&gt;</code>中添加对应的<code>flexible_css.js,flexible.js</code>文件：<br><br>第一种方法是将文件下载到你的项目中，然后通过相对路径添加:<br></p>
<pre><code>&lt;script src=&quot;build/flexible_css.debug.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;build/flexible.debug.js&quot;&gt;&lt;/script&gt;
</code></pre><p>或者直接加载阿里CDN的文件：<br></p>
<pre><code>&lt;script src=&quot;http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js&quot;&gt;&lt;/script&gt;
</code></pre><p>另外强烈建议对JS做<strong>内联处理</strong>，在所有资源加载之前执行这个JS。执行这个JS后，会在<code>&lt;html&gt;</code>元素上增加一个<code>data-dpr</code>属性，以及一个<code>font-size</code>样式。JS会根据不同的设备添加不同的<code>data-dpr</code>值，比如说2或者3，同时会给<code>html</code>加上对应的<code>font-size</code>的值，比如说75px。<br><br>如此一来，页面中的元素，都可以通过<code>rem</code>单位来设置。他们会根据<code>html</code>元素的<code>font-size</code>值做相应的计算，从而实现屏幕的适配效果。<br><br>此之外，在引入<code>lib-flexible</code>需要执行的JS之前，可以手动设置<code>meta</code>来控制<code>dpr</code>值，如：<br></p>
<pre><code>&lt;meta name=&quot;flexible&quot; content=&quot;initial-dpr=2&quot; /&gt;
</code></pre><p>其中<code>initial-dpr</code>会把<code>dpr</code>强制设置为给定的值。如果手动设置了<code>dpr</code>之后，不管设备是多少的<code>dpr</code>，都会强制认为其<code>dpr</code>是你设置的值。在此不建议手动强制设置<code>dpr</code>，因为在<code>Flexible</code>中，只对iOS设备进行<code>dpr</code>的判断，对于Android系列，始终认为其<code>dpr</code>为<code>1</code>。<br></p>
<pre><code>if (!dpr &amp;&amp; !scale) {
var isAndroid = win.navigator.appVersion.match(/android/gi);
var isIPhone = win.navigator.appVersion.match(/iphone/gi);
var devicePixelRatio = win.devicePixelRatio;
if (isIPhone) {
    // iOS下，对于2和3的屏，用2倍的方案，其余的用1倍方案
    if (devicePixelRatio &gt;= 3 &amp;&amp; (!dpr || dpr &gt;= 3)) {                
        dpr = 3;
    } else if (devicePixelRatio &gt;= 2 &amp;&amp; (!dpr || dpr &gt;= 2)){
        dpr = 2;
    } else {
        dpr = 1;
    }
} else {
    // 其他设备下，仍旧使用1倍的方案
    dpr = 1;
}
scale = 1 / dpr;
}
</code></pre><h4 id="flexible的实质"><a href="#flexible的实质" class="headerlink" title="flexible的实质"></a>flexible的实质</h4><p><code>flexible</code>实际上就是能过JS来动态改写<code>meta</code>标签，代码类似这样：<br></p>
<pre><code>var metaEl = doc.createElement(&apos;meta&apos;);
var scale = isRetina ? 0.5:1;
metaEl.setAttribute(&apos;name&apos;, &apos;viewport&apos;);
metaEl.setAttribute(&apos;content&apos;, &apos;initial-scale=&apos; + scale + &apos;, maximum-scale=&apos; + scale + &apos;, minimum-scale=&apos; + scale + &apos;, user-scalable=no&apos;);
if (docEl.firstElementChild) {
    document.documentElement.firstElementChild.appendChild(metaEl);
} else {
    var wrap = doc.createElement(&apos;div&apos;);
    wrap.appendChild(metaEl);
    documen.write(wrap.innerHTML);
}
</code></pre><p>事实上他做了这几样事情：<br></p>
<ul>
<li>动态改写<meta>标签</li>
<li>给<code>&lt;html&gt;</code>元素添加<code>data-dpr</code>属性，并且动态改写<code>data-dpr</code>的值</li>
<li>给<code>&lt;html&gt;</code>元素添加<code>font-size</code>属性，并且动态改写<code>font-size</code>的值</li>
</ul>
<h3 id="案例实战"><a href="#案例实战" class="headerlink" title="案例实战"></a>案例实战</h3><hr>
<p>了解Flexible相关的知识之后，咱们回到文章开头。我们的目标是制作一个适配各终端的H5页面。别的不多说，动手才能丰衣足食。<br></p>
<h4 id="创建HTML模板"><a href="#创建HTML模板" class="headerlink" title="创建HTML模板"></a>创建HTML模板</h4><pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;meta content=&quot;yes&quot; name=&quot;apple-mobile-web-app-capable&quot;&gt;
        &lt;meta content=&quot;yes&quot; name=&quot;apple-touch-fullscreen&quot;&gt;
        &lt;meta content=&quot;telephone=no,email=no&quot; name=&quot;format-detection&quot;&gt;
        &lt;script src=&quot;http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js&quot;&gt;&lt;/script&gt;
        &lt;link rel=&quot;apple-touch-icon&quot; href=&quot;favicon.png&quot;&gt;
        &lt;link rel=&quot;Shortcut Icon&quot; href=&quot;favicon.png&quot; type=&quot;image/x-icon&quot;&gt;
        &lt;title&gt;再来一波&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;!-- 页面结构写在这里 --&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>正如前面所介绍的一样，首先加载了Flexible所需的配置：<br></p>
<pre><code>&lt;script src=&quot;http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js&quot;&gt;&lt;/script&gt;
</code></pre><p>这个时候可以根据设计的图需求，在HTML文档的<code>&lt;body&gt;&lt;/body&gt;</code>中添加对应的HTML结构，比如：<br></p>
<pre><code>&lt;div class=&quot;item-section&quot; data-repeat=&quot;sections&quot;&gt;
&lt;div class=&quot;item-section_header&quot;&gt;
    &lt;h2&gt;&lt;img src=&quot;{brannerImag}&quot; alt=&quot;&quot;&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;ul&gt;
    &lt;li data-repeat=&quot;items&quot; class=&quot;flag&quot; role=&quot;link&quot; href=&quot;{itemLink}&quot;&gt;
        &lt;a class=&quot;figure flag-item&quot; href=&quot;{itemLink}&quot;&gt;
            &lt;img src=&quot;{imgSrc}&quot; alt=&quot;&quot;&gt;
        &lt;/a&gt;
        &lt;div class=&quot;figcaption flag-item&quot;&gt;
            &lt;div class=&quot;flag-title&quot;&gt;&lt;a href=&quot;{itemLink}&quot; title=&quot;&quot;&gt;{poductName}&lt;/a&gt;&lt;/div&gt;
            &lt;div class=&quot;flag-price&quot;&gt;&lt;span&gt;双11价&lt;/span&gt;&lt;strong&gt;¥{price}&lt;/strong&gt;&lt;small&gt;({preferential})&lt;/small&gt;&lt;/div&gt;
            &lt;div class=&quot;flag-type&quot;&gt;{activityType}&lt;/div&gt;
            &lt;a class=&quot;flag-btn&quot; href=&quot;{shopLink}&quot;&gt;{activeName}&lt;/a&gt;
        &lt;/div&gt;
    &lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</code></pre><p>这仅是一个示例文档，大家可以根据自己风格写模板。<br><br>为了能更好的测试页面，给其配置一点假数据：<br></p>
<pre><code>//define data
var pageData = {
    sections:[{
        &quot;brannerImag&quot;:&quot;http://xxx.cdn.com/B1PNLZKXXXXXaTXXXXXXXXXXXX-750-481.jpg&quot;,
        items:[{
            &quot;itemLink&quot;: &quot;##&quot;,
            &quot;imgSrc&quot;: &quot;https://placeimg.com/350/350/people/grayscale&quot;,
            &quot;poductName&quot;:&quot;Carter&apos;s1年式灰色长袖连体衣包脚爬服全棉鲸鱼男婴儿童装115G093&quot;,
            &quot;price&quot;: &quot;299.06&quot;,
            &quot;preferential&quot;: &quot;满400减100&quot;,
            &quot;activityType&quot;: &quot;1小时内热卖5885件&quot;,
            &quot;shopLink&quot;:&quot;##&quot;,
            &quot;activeName&quot;: &quot;马上抢！&quot;
        }
            ....
        }]
    }]
}
</code></pre><p>接下来的工作就是美化工作了。在写具体样式之前，有几个点需要先了解一下。<br></p>
<h4 id="把视觉稿中的px转换成rem"><a href="#把视觉稿中的px转换成rem" class="headerlink" title="把视觉稿中的px转换成rem"></a>把视觉稿中的px转换成rem</h4><p>读到这里，大家应该都知道，我们接下来要做的事情，就是如何把视觉稿中的<code>px</code>转换成<code>rem</code>。在此花点时间解释一下。<br><br>首先，目前日常工作当中，视觉设计师给到前端开发人员手中的视觉稿尺寸一般是基于<code>640px</code>、<code>750px</code>以及<code>1125px</code>宽度为准。甚至为什么？大家应该懂的（考虑Retina屏）。<br><br>正如文章开头显示的示例设计稿，他就是一张以<code>750px</code>为基础设计的。那么问题来了，我们如何将设计稿中的各元素的<code>px</code>转换成<code>rem</code>。<br><br><img src="http://cdn2.w3cplus.com/cdn/farfuture/hKfao4CS_yygi0EEUF1xMOb7NROYEu680tlykfjZzLs/mtime:1447828705/sites/default/files/blogs/2015/1511/rem-8.png" alt=""><br><br>我厂的视觉设计师想得还是很周到的，会帮你把相关的信息在视觉稿上标注出来。<br><br>目前Flexible会将视觉稿分成<code>100份</code>（主要为了以后能更好的兼容<code>vh</code>和<code>vw</code>），而每一份被称为一个单位<code>a</code>。同时<code>1rem</code>单位被认定为<code>10a</code>。针对我们这份视觉稿可以计算出：<br></p>
<pre><code>1a   = 7.5px
1rem = 75px 
</code></pre><p>那么我们这个示例的稿子就分成了<code>10a</code>，也就是整个宽度为<code>10rem</code>，<code>&lt;html&gt;</code>对应的<code>font-size</code>为<code>75px</code>：<br><br><img src="http://cdn1.w3cplus.com/cdn/farfuture/h0w7oXfqJgirNWw4PPa2GZWyyAsPRGvxLRWCZYPE_Y4/mtime:1447769998/sites/default/files/blogs/2015/1511/rem-2.jpg" alt=""><br><br>这样一来，对于视觉稿上的元素尺寸换算，只需要原始的<code>px</code>值除以<code>rem</code>基准值即可。例如此例视觉稿中的图片，其尺寸是<code>176px * 176px</code>,转换成为<code>2.346667rem * 2.346667rem</code>。<br></p>
<h4 id="如何快速计算"><a href="#如何快速计算" class="headerlink" title="如何快速计算"></a>如何快速计算</h4><p>在实际生产当中，如果每一次计算<code>px</code>转换<code>rem</code>，或许会觉得非常麻烦，或许直接影响大家平时的开发效率。为了能让大家更快进行转换，我们团队内的同学各施所长，为<code>px</code>转换<code>rem</code>写了各式各样的小工具。<br></p>
<h4 id="CSSREM"><a href="#CSSREM" class="headerlink" title="CSSREM"></a>CSSREM</h4><p><a href="https://github.com/flashlizi/cssrem" target="_blank" rel="external">CSSREM</a>是一个CSS的px值转rem值的Sublime Text3自动完成插件。这个插件是由<a href="https://github.com/flashlizi" target="_blank" rel="external">@正霖</a>编写。先来看看插件的效果：<br><br><img src="http://cdn1.w3cplus.com/cdn/farfuture/Mn934L-OJUnahLoJ7qLdEDvmYFbD_O8SVgH7SovnaWg/mtime:1447830963/sites/default/files/blogs/2015/1511/cssrem.gif" alt=""><br><br>有关于CSSREM如何安装、配置教程可以<a href="https://github.com/flashlizi/cssrem" target="_blank" rel="external">点击这里查阅</a>。<br></p>
<h4 id="CSS处理器"><a href="#CSS处理器" class="headerlink" title="CSS处理器"></a>CSS处理器</h4><p>除了使用编辑器的插件之外，还可以使用CSS的处理器来帮助大家处理。比如说Sass、LESS以及PostCSS这样的处理器。我们简单来看两个示例。<br></p>
<h5 id="Sass"><a href="#Sass" class="headerlink" title="Sass"></a>Sass</h5><p>使用<a href="http://www.w3cplus.com/blog/tags/302.html" target="_blank" rel="external">Sass</a>的同学，可以使用Sass的函数、混合宏这些功能来实现：<br></p>
<pre><code>@function px2em($px, $base-font-size: 16px) {
@if (unitless($px)) {
    @warn &quot;Assuming #{$px} to be in pixels, attempting to convert it into pixels for you&quot;;
    @return px2em($px + 0px); // That may fail.
} @else if (unit($px) == em) {
    @return $px;
}
@return ($px / $base-font-size) * 1em;
}
</code></pre><p>除了使用Sass函数外，还可以使用Sass的混合宏：<br></p>
<pre><code>@mixin px2rem($property,$px-values,$baseline-px:16px,$support-for-ie:false){
//Conver the baseline into rems
$baseline-rem: $baseline-px / 1rem * 1;
//Print the first line in pixel values
@if $support-for-ie {
    #{$property}: $px-values;
}
//if there is only one (numeric) value, return the property/value line for it.
@if type-of($px-values) == &quot;number&quot;{
    #{$property}: $px-values / $baseline-rem;
}
@else {
    //Create an empty list that we can dump values into
    $rem-values:();
    @each $value in $px-values{
        // If the value is zero or not a number, return it
        @if $value == 0 or type-of($value) != &quot;number&quot;{
            $rem-values: append($rem-values, $value / $baseline-rem);
        }
    }
    // Return the property and its list of converted values
    #{$property}: $rem-values;
}
}
</code></pre><p>有关于更多的介绍，可以<a href="http://www.w3cplus.com/blog/tags/143.html" target="_blank" rel="external">点击这里</a>进行了解。<br></p>
<h4 id="PostCSS-px2rem"><a href="#PostCSS-px2rem" class="headerlink" title="PostCSS(px2rem)"></a>PostCSS(px2rem)</h4><p>了Sass这样的CSS处理器这外，我们团队的<a href="http://weibo.com/u/2168835224" target="_blank" rel="external">@颂奇</a>同学还开发了一款npm的工具<a href="https://www.npmjs.com/package/px2rem" target="_blank" rel="external">px2rem</a>。安装好<a href="https://www.npmjs.com/package/px2rem" target="_blank" rel="external">px2rem</a>之后，可以在项目中直接使用。也可以使用<a href="http://www.w3cplus.com/blog/tags/516.html" target="_blank" rel="external">PostCSS</a>。使用PostCSS插件<a href="https://www.npmjs.com/package/postcss-px2rem" target="_blank" rel="external">postcss-px2rem</a>：<br></p>
<pre><code>var gulp = require(&apos;gulp&apos;);
var postcss = require(&apos;gulp-postcss&apos;);
var px2rem = require(&apos;postcss-px2rem&apos;);

gulp.task(&apos;default&apos;, function() {
    var processors = [px2rem({remUnit: 75})];
    return gulp.src(&apos;./src/*.css&apos;)
        .pipe(postcss(processors))
        .pipe(gulp.dest(&apos;./dest&apos;));
});
</code></pre><p>除了在Gulp中配置外，还可以使用其他的配置方式，详细的介绍可以<a href="https://www.npmjs.com/package/postcss-px2rem" target="_blank" rel="external">点击这里</a>进行了解。<br><br>配置完成之后，在实际使用时，你只要像下面这样使用：<br></p>
<pre><code>.selector {
width: 150px;
height: 64px; /*px*/
font-size: 28px; /*px*/
border: 1px solid #ddd; /*no*/
}
</code></pre><p><code>px2rem</code>处理之后将会变成：<br></p>
<pre><code>.selector {
width: 2rem;
border: 1px solid #ddd;
}
[data-dpr=&quot;1&quot;] .selector {
    height: 32px;
    font-size: 14px;
}
[data-dpr=&quot;2&quot;] .selector {
    height: 64px;
    font-size: 28px;
}
[data-dpr=&quot;3&quot;] .selector {
    height: 96px;
    font-size: 42px;
}
</code></pre><p>在整个开发中有了这些工具之后，完全不用担心<code>px</code>值转<code>rem</code>值影响开发效率。<br></p>
<h4 id="字号不使用rem"><a href="#字号不使用rem" class="headerlink" title="字号不使用rem"></a>字号不使用rem</h4><p>前面大家都见证了如何使用<code>rem</code>来完成H5适配。那么文本又将如何处理适配。是不是也通过<code>rem</code>来做自动适配。<br><br>显然，我们在iPhone3G和iPhone4的Retina屏下面，希望看到的文本字号是相同的。也就是说，我们<strong>不希望文本在Retina屏幕下变小</strong>，另外，我们<strong>希望在大屏手机上看到更多文本</strong>，以及，现在绝大多数的字体文件都自带一些点阵尺寸，通常是16px和24px，所以我们<strong>不希望出现13px</strong>和<strong>15px</strong>这样的奇葩尺寸。<br><br>如此一来，就决定了在制作H5的页面中，<code>rem</code>并不适合用到段落文本上。所以在Flexible整个适配方案中，考虑文本还是使用<code>px</code>作为单位。只不过使用<code>[data-dpr]</code>属性来区分不同<code>dpr</code>下的文本字号大小。<br></p>
<pre><code>div {
width: 1rem; 
height: 0.4rem;
font-size: 12px; // 默认写上dpr为1的fontSize
}
[data-dpr=&quot;2&quot;] div {
    font-size: 24px;
}
[data-dpr=&quot;3&quot;] div {
    font-size: 36px;
}
</code></pre><p>为了能更好的利于开发，在实际开发中，我们可以定制一个<a href="https://github.com/W3cplus/Sass-Resources/blob/master/mixins/_font-dpr.scss" target="_blank" rel="external">font-dpr()</a>这样的Sass混合宏：<br></p>
<pre><code>@mixin font-dpr($font-size){
font-size: $font-size;

[data-dpr=&quot;2&quot;] &amp; {
    font-size: $font-size * 2;
}

[data-dpr=&quot;3&quot;] &amp; {
    font-size: $font-size * 3;
}
}
</code></pre><p>有了这样的混合宏之后，在开发中可以直接这样使用：<br></p>
<pre><code>@include font-dpr(16px);
</code></pre><p>当然这只是针对于描述性的文本，比如说段落文本。但有的时候文本的字号也需要分场景的，比如在项目中有一个slogan,业务方希望这个slogan能根据不同的终端适配。针对这样的场景，完全可以使用rem给slogan做计量单位。<br></p>
<h4 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h4><p>本来想把这个页面的用到的CSS(或SCSS)贴出来，但考虑篇幅过长，而且这么简单的页面，我想大家也能轻而易举搞定。所以就省略了。权当是给大家留的一个作业吧，感兴趣的可以试试Flexible能否帮你快速完成H5页面终端适配。<br></p>
<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><hr>
<p>最后来看看真机上显示的效果吧。我截了两种设备下的效果：<br></p>
<h4 id="iPhone4"><a href="#iPhone4" class="headerlink" title="iPhone4"></a>iPhone4</h4><p><img src="http://cdn.w3cplus.com/cdn/farfuture/YhlgyAvcvtOe54709eeCV9lrooOFzNJIhMEEj921fzs/mtime:1447841119/sites/default/files/blogs/2015/1511/rem-9.jpg" alt=""><br></p>
<h4 id="iPhone6"><a href="#iPhone6" class="headerlink" title="iPhone6+"></a>iPhone6+</h4><p><img src="http://cdn2.w3cplus.com/cdn/farfuture/gL7chP84773JBDGVVNjVp2m7yl2s9ecFv54nyQcaikk/mtime:1447841119/sites/default/files/blogs/2015/1511/rem-10.png" alt=""><br></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><hr>
<p>其实H5适配的方案有很多种，网上有关于这方面的教程也非常的多。不管哪种方法，都有其自己的优势和劣势。而本文主要介绍的是如何使用Flexible这样的一库来完成H5页面的终端适配。为什么推荐使用Flexible库来做H5页面的终端设备适配呢？主要因为这个库在手淘已经使用了近一年，而且已达到了较为稳定的状态。除此之外，你不需要考虑如何对元素进行折算，可以根据对应的视觉稿，直接切入。<br><br>当然，如果您有更好的H5页面终端适配方案，欢迎在下面的评论中与我们一起分享。如果您在使用这个库时，碰到任何问题，都可以在Github给我们提<a href="https://github.com/amfe/lib-flexible/issues" target="_blank" rel="external">Issue</a>。我们团队会努力解决相关需Issues。<br></p>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><hr>
<p>学们反馈需要一个在线演示的DEMO。那么花了点时间写了个demo，希望对有需要的同学有所帮助。友情提示：<strong>DEMO未经过所有设备测试，可能在部分设备上有细节上的差异</strong><br><br><a href="http://huodong.m.taobao.com/act/yibo.html" target="_blank" rel="external">DEMO</a><br><br>请用手机扫下面的二维码<br><br><img src="http://cdn2.w3cplus.com/cdn/farfuture/RqdfEdIqyYInpUeFzDLoWrYJIaGIHzqPMrRWT9merUc/mtime:1448593751/sites/default/files/blogs/2015/1511/yiboqr.png" alt=""><br></p>
<h3 id="更新【2016年01月13日】"><a href="#更新【2016年01月13日】" class="headerlink" title="更新【2016年01月13日】"></a>更新【2016年01月13日】</h3><hr>
<p>首先，由衷的感谢@完颜 帮忙踩了这个坑，回想起iOS从7~8，从8~9，都踩过只至少一个坑，真的也是醉了。<br><br>手淘这边的flexible方案临时升级如下：<br></p>
<ul>
<li>针对OS 9_3的UA，做临时处理，强制dpr为1，即scale也为1，虽然牺牲了这些版本上的高清方案，但是也只能这么处理了</li>
<li>这个版本不打算发布到CDN（也不发不到tnpm），所以大家更新的方式，最好手动复制代码内联到html中，具体代码可以<a href="http://www.w3cplus.com/sites/default/files/blogs/2016/1601/flexible.js" target="_blank" rel="external">点击这里下载</a><br></li>
</ul>
<p>转自：<a href="http://www.w3cplus.com/mobile/lib-flexible-for-html5-layout.html" target="_blank" rel="external">http://www.w3cplus.com/mobile/lib-flexible-for-html5-layout.html</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/HTML5/" rel="tag"># HTML5</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/05/37/" rel="next" title="知道这20个正则表达式，能让你少写1,000行代码🐰">
                <i class="fa fa-chevron-left"></i> 知道这20个正则表达式，能让你少写1,000行代码🐰
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/13/39/" rel="prev" title=" CSS hack大全&详解（什么是CSS hack）👾">
                 CSS hack大全&详解（什么是CSS hack）👾 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
    <!-- 多说评论框 start -->  
        <div class="ds-thread" data-thread-key="<%- page.path %>" data-title="<%- page.title %>" data-url="<%- page.permalink %>"></div>  
<!-- 多说评论框 end -->    
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->  
<script type="text/javascript">  
var duoshuoQuery = {short_name:"yuzhiyun"};  
    (function() {  
        var ds = document.createElement('script');  
        ds.type = 'text/javascript';ds.async = true;  
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';  
        ds.charset = 'UTF-8';  
        (document.getElementsByTagName('head')[0]   
         || document.getElementsByTagName('body')[0]).appendChild(ds);  
    })();  
    </script>  
<!-- 多说公共JS代码 end -->  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="menggeNIU" />
          <p class="site-author-name" itemprop="name">menggeNIU</p>
          <p class="site-description motion-element" itemprop="description">个人收藏</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">50</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/menggeNiu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/1967072037" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://zjflove.github.io" title="zjf" target="_blank">zjf</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.901web.com" title="pybyongbo" target="_blank">pybyongbo</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#目标"><span class="nav-number">1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#痛点"><span class="nav-number">2.</span> <span class="nav-text">痛点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手淘团队适配协作模式"><span class="nav-number">3.</span> <span class="nav-text">手淘团队适配协作模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#前端开发完成终端适配方案"><span class="nav-number">4.</span> <span class="nav-text">前端开发完成终端适配方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一些基本概念"><span class="nav-number">4.1.</span> <span class="nav-text">一些基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#视窗-viewport"><span class="nav-number">4.1.1.</span> <span class="nav-text">视窗 viewport</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#物理像素-physical-pixel"><span class="nav-number">4.1.2.</span> <span class="nav-text">物理像素(physical pixel)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#设备独立像素-density-independent-pixel"><span class="nav-number">4.1.3.</span> <span class="nav-text">设备独立像素(density-independent pixel)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CSS像素"><span class="nav-number">4.1.4.</span> <span class="nav-text">CSS像素</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#屏幕密度"><span class="nav-number">4.1.5.</span> <span class="nav-text">屏幕密度</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#设备像素比-device-pixel-ratio"><span class="nav-number">4.1.6.</span> <span class="nav-text">设备像素比(device pixel ratio)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#meta标签"><span class="nav-number">4.2.</span> <span class="nav-text">meta标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSS单位rem"><span class="nav-number">4.3.</span> <span class="nav-text">CSS单位rem</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#前端实现方案"><span class="nav-number">5.</span> <span class="nav-text">前端实现方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lib-flexible是什么？"><span class="nav-number">5.1.</span> <span class="nav-text">lib-flexible是什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用方法"><span class="nav-number">5.2.</span> <span class="nav-text">使用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#flexible的实质"><span class="nav-number">5.3.</span> <span class="nav-text">flexible的实质</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#案例实战"><span class="nav-number">6.</span> <span class="nav-text">案例实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建HTML模板"><span class="nav-number">6.1.</span> <span class="nav-text">创建HTML模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#把视觉稿中的px转换成rem"><span class="nav-number">6.2.</span> <span class="nav-text">把视觉稿中的px转换成rem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如何快速计算"><span class="nav-number">6.3.</span> <span class="nav-text">如何快速计算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSSREM"><span class="nav-number">6.4.</span> <span class="nav-text">CSSREM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSS处理器"><span class="nav-number">6.5.</span> <span class="nav-text">CSS处理器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Sass"><span class="nav-number">6.5.1.</span> <span class="nav-text">Sass</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PostCSS-px2rem"><span class="nav-number">6.6.</span> <span class="nav-text">PostCSS(px2rem)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字号不使用rem"><span class="nav-number">6.7.</span> <span class="nav-text">字号不使用rem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSS"><span class="nav-number">6.8.</span> <span class="nav-text">CSS</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效果"><span class="nav-number">7.</span> <span class="nav-text">效果</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#iPhone4"><span class="nav-number">7.1.</span> <span class="nav-text">iPhone4</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iPhone6"><span class="nav-number">7.2.</span> <span class="nav-text">iPhone6+</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">8.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新"><span class="nav-number">9.</span> <span class="nav-text">更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新【2016年01月13日】"><span class="nav-number">10.</span> <span class="nav-text">更新【2016年01月13日】</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">menggeNIU</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"nnnmg"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js?v=5.1.0"></script>
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("elhh73EjPvJjogo27rOTNyxB-gzGzoHsz", "ICYhjaCGuWcsPbm8nPit7Gkh");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
